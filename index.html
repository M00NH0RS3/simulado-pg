<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="image.png" type="image/png" />
  <title>Simulado - Policiamento de Guarda</title>
  <meta name="theme-color" content="#38bdf8" />

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker
        .register("sw.js")
        .then(() => console.log("Service Worker registrado"))
        .catch((err) => console.error("SW erro:", err));
    }
  </script>

  <style>
    :root {
      --bg: #0f172a;
      --card: #0b1222f2;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #38bdf8;
      --ok: #16a34a;
      --bad: #dc2626;
      --border: #334155;
    }

    a:link {
      text-decoration: none;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 10% -10%,
          rgba(56, 189, 248, 0.15),
          transparent),
        radial-gradient(1000px 600px at 120% 20%,
          rgba(34, 197, 94, 0.12),
          transparent),
        var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
        "Helvetica Neue", Arial;
    }

    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px;
    }

    header {
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    header h1 {
      font-size: 1.25rem;
      margin: 0;
    }

    .card {
      background: var(--card);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    .panel {
      padding: 16px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .chip {
      background: #0b1328;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .btn {
      appearance: none;
      border: 1px solid var(--border);
      background: #0a1222;
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 700;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
    }

    .btn.primary {
      background: linear-gradient(135deg, #38bdf8, #34d399);
      border-color: transparent;
      color: #001018;
    }

    .q {
      padding: 16px;
      border-top: 1px dashed var(--border);
    }

    .q-head {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    .q-title {
      font-weight: 700;
    }

    .q-body {
      margin-top: 8px;
    }

    .alt {
      display: block;
      margin: 0.25rem 0;
      padding: 0.35rem 0.6rem;
      border: 1px solid transparent;
      border-radius: 10px;
      cursor: pointer;
    }

    .alt input {
      margin-right: 0.5rem;
    }

    .alt.sel {
      border-color: #1f2937;
      background: #0f1a33;
    }

    .status {
      margin-top: 8px;
      font-size: 0.95rem;
    }

    .status.ok {
      color: var(--ok);
    }

    .status.bad {
      color: var(--bad);
    }

    .ok-bg {
      background: rgba(22, 163, 74, 0.12);
      border: 1px solid rgba(22, 163, 74, 0.35);
    }

    .bad-bg {
      background: rgba(220, 38, 38, 0.1);
      border: 1px solid rgba(220, 38, 38, 0.35);
    }

    .tools {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin: 12px 0 0;
    }

    .footer {
      margin: 24px 0 40px;
      color: var(--muted);
      font-size: 0.9rem;
      text-align: center;
    }

    details {
      background: #0b1328;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      margin: 12px 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>üìù Simulado ‚Äì PG (100 quest√µes)</h1>
      <div class="row">
        <span id="score" class="chip">Acertos: 0/0</span>
        <span id="aproveitamento" class="chip">Aproveitamento: 0%</span>
      </div>
    </header>

    <section id="exam" class="card panel">
      <div class="row" style="justify-content: space-between">
        <strong>Marque suas respostas e clique em <em>Verificar Tudo</em> ao final
          para obter o resultado.</strong>
        <details>
          <summary>Como funciona</summary>
          <ul>
            <li>
              Responda as quest√µes de m√∫ltipla escolha e as quest√µes de
              verdadeiro/falso.
            </li>
            <li>
              Ao verificar, a quest√£o fica
              <b style="color: var(--ok)">verde</b> se correta,
              <b style="color: var(--bad)">vermelha</b> se incorreta e mostra
              a alternativa certa.
            </li>
            <li>Voc√™ pode <b>exportar</b> um CSV com resultados.</li>
          </ul>
        </details>
        <div class="row">
          <button id="btnReset" class="btn">Resetar</button>
          <button id="btnExport" class="btn">Exportar CSV</button>
          <a class="btn primary" href="resumo.html">Resumo da Mat√©ria</a>
        </div>
      </div>
      <div id="lista"></div>
      <button id="btnCheckAll" class="btn primary">Verificar Tudo</button>
    </section>

    <!-- <p class="footer">&copy; 2025 CFSd Hotel</p> -->
  </div>

  <script>
    const questoes = [
      // --- BASE LEGAL ---
      { n: 1, enu: "A seguran√ßa p√∫blica √© dever do Estado, direito e responsabilidade de todos (CF/88).", vf: true, correta: "V" },
      { n: 2, enu: "O Corpo de Bombeiros integra:", alts: ["As For√ßas Armadas", "Os √≥rg√£os de seguran√ßa p√∫blica", "O Poder Judici√°rio", "O SUS"], correta: "b" },
      { n: 3, enu: "A Emenda Constitucional 39/99 aplica ao CBMMG:", alts: ["Legisla√ß√£o da Pol√≠cia Federal", "Legisla√ß√£o da PM enquanto n√£o houver lei espec√≠fica", "Legisla√ß√£o civil", "Nenhuma"], correta: "b" },
      { n: 4, enu: "O art. 142 da Constitui√ß√£o Estadual trata das compet√™ncias do CBMMG.", vf: true, correta: "V" },
      { n: 5, enu: "A Resolu√ß√£o 152/2005 do CBMMG regulamenta:", alts: ["Emprego de alunos em guarda", "Uso de viaturas", "Escalas administrativas", "Cursos de forma√ß√£o"], correta: "a" },

      // --- FUN√á√ïES NA GUARDA ---
      { n: 6, enu: "Fun√ß√£o do Oficial de Dia:", alts: ["Apenas controlar entrada", "Executar rondas externas", "Coordenar toda a guarda", "Escalar o sentinela"], correta: "c" },
      { n: 7, enu: "O sentinela √© respons√°vel por controlar entradas e sa√≠das.", vf: true, correta: "V" },
      { n: 8, enu: "O corpo da guarda possui acesso restrito.", vf: true, correta: "V" },
      { n: 9, enu: "O Comandante da Guarda executa:", alts: ["Coordena√ß√£o do Corpo da Guarda", "Escalas administrativas", "Apenas rondas externas", "Nada disso"], correta: "a" },
      { n: 10, enu: "O plano de seguran√ßa da unidade define rotinas, atribui√ß√µes e pontos cr√≠ticos.", vf: true, correta: "V" },

      // --- CONCEITOS ---
      { n: 11, enu: "Exemplo de ponto sens√≠vel:", alts: ["Port√£o lateral", "Caixa d‚Äô√°gua", "Muro baixo", "Arbusto"], correta: "b" },
      { n: 12, enu: "Exemplo de ponto vulner√°vel:", alts: ["Janela com acesso √† rua", "Gabinete do comando", "Transformador", "Intend√™ncia"], correta: "a" },
      { n: 13, enu: "Abrigo protege contra proj√©teis; coberta apenas esconde.", vf: true, correta: "V" },
      { n: 14, enu: "Arbusto √© exemplo de abrigo.", vf: true, correta: "F" },
      { n: 15, enu: "Guarita √© exemplo de posto fixo, enquanto ronda perimetral √© posto m√≥vel.", vf: true, correta: "V" },

      // --- PREPARO MENTAL ---
      { n: 16, enu: "Estado de prontid√£o branco significa:", alts: ["Distra√ß√£o", "Aten√ß√£o constante", "Confronto prov√°vel", "P√¢nico"], correta: "a" },
      { n: 17, enu: "Estado amarelo √© vigil√¢ncia 360¬∞ e aten√ß√£o constante.", vf: true, correta: "V" },
      { n: 18, enu: "Estado laranja significa problema detectado, confronto prov√°vel.", vf: true, correta: "V" },
      { n: 19, enu: "Estado vermelho = risco real, resposta necess√°ria.", vf: true, correta: "V" },
      { n: 20, enu: "Estado preto √© desej√°vel em ocorr√™ncias cr√≠ticas.", vf: true, correta: "F" },

      // --- PENSAMENTO T√ÅTICO ---
      { n: 21, enu: "O quarteto do pensamento t√°tico inclui √°rea de seguran√ßa, √°rea de risco, ponto de foco e ponto quente.", vf: true, correta: "V" },
      { n: 22, enu: "Como primeiro interventor, deve-se sempre entrar na √°rea de risco imediatamente.", vf: true, correta: "F" },
      { n: 23, enu: "Risco = Vulnerabilidade √ó Amea√ßa.", vf: true, correta: "V" },
      { n: 24, enu: "Supremacia de for√ßa pode ser obtida por:", alts: ["Surpresa e autocontrole", "Apenas quantidade de efetivo", "Exclusivamente armas de fogo", "Trucul√™ncia"], correta: "a" },
      { n: 25, enu: "Autoidentifica√ß√£o comp√µe a supremacia de for√ßa.", vf: true, correta: "V" },

      // --- USO DA FOR√áA / ALGEMAS ---
      { n: 26, enu: "N√≠vel prim√°rio do uso da for√ßa √©:", alts: ["Verbaliza√ß√£o e presen√ßa", "Uso letal", "Controle f√≠sico", "Algemamento"], correta: "a" },
      { n: 27, enu: "Uso diferenciado da for√ßa √© din√¢mico, pode subir ou reduzir.", vf: true, correta: "V" },
      { n: 28, enu: "SV 11 (STF): algemas s√≥ em caso de resist√™ncia, receio de fuga ou perigo √† integridade.", vf: true, correta: "V" },
      { n: 29, enu: "CPP art. 284: permite for√ßa ilimitada.", vf: true, correta: "F" },
      { n: 30, enu: "Algemas devem ser travadas, ajustadas e acompanhadas de vigil√¢ncia.", vf: true, correta: "V" },

      // --- ABORDAGEM ---
      { n: 31, enu: "Fundamentos da abordagem incluem: seguran√ßa, surpresa, rapidez, a√ß√£o vigorosa e unidade de comando.", vf: true, correta: "V" },
      { n: 32, enu: "A√ß√£o vigorosa significa trucul√™ncia.", vf: true, correta: "F" },
      { n: 33, enu: "Busca pessoal completa deve ocorrer em local isolado e com testemunha do mesmo sexo.", vf: true, correta: "V" },
      { n: 34, enu: "Regra dos 21 p√©s (6,4m) refere-se a dist√¢ncia m√≠nima em suspeito com faca.", vf: true, correta: "V" },
      { n: 35, enu: "Posi√ß√£o guarda-baixa (arma a 45¬∞) √© ideal para deslocamento.", vf: true, correta: "V" },
      { n: 36, enu: "Posi√ß√£o de pronta resposta s√≥ deve ser usada em risco letal real.", vf: true, correta: "V" },

      // --- DESLOCAMENTO / VARREDURA ---
      { n: 37, enu: "No deslocamento t√°tico, posi√ß√£o normal √© usada com arma no coldre.", vf: true, correta: "V" },
      { n: 38, enu: "Fatiamento significa checar por segmentos o ambiente.", vf: true, correta: "V" },
      { n: 39, enu: "Olhada r√°pida serve para ver sem ser visto.", vf: true, correta: "V" },
      { n: 40, enu: "Reflex√£o de imagem pode ser usada em espelhos e superf√≠cies.", vf: true, correta: "V" },

      // --- T√ÅTICA TAT ---
      { n: 41, enu: "TAT forma tri√¢ngulo entre 2 PMs e o abordado.", vf: true, correta: "V" },
      { n: 42, enu: "No TAT, dist√¢ncia entre PMs √© de ~4m e do abordado ~3m.", vf: true, correta: "V" },
      { n: 43, enu: "No TAT, h√° fun√ß√µes de Comandante, Verbalizador, Seguran√ßa e Revistador.", vf: true, correta: "V" },
      { n: 44, enu: "Regra dos 21 p√©s n√£o se aplica em TAT.", vf: true, correta: "F" },

      // --- VE√çCULOS ---
      { n: 45, enu: "Na abordagem de ve√≠culo, o posicionamento pode ser diagonal ou paralelo.", vf: true, correta: "V" },
      { n: 46, enu: "Capacetes de motociclistas devem ser retirados imediatamente na abordagem.", vf: true, correta: "F" },
      { n: 47, enu: "Na abordagem de moto, motor deve ser desligado e condutor desembarcar com m√£os na cabe√ßa.", vf: true, correta: "V" },

      // --- EQUIPAMENTOS ---
      { n: 48, enu: "Exemplo de equipamento essencial: colete bal√≠stico.", vf: true, correta: "V" },
      { n: 49, enu: "A capa do colete deve conter informa√ß√£o de n√≠vel de prote√ß√£o, sexo e tamanho.", vf: true, correta: "V" },
      { n: 50, enu: "Lanterna, apito e comunica√ß√£o fazem parte dos itens obrigat√≥rios.", vf: true, correta: "V" },

      // --- BASE LEGAL / PODER DE POL√çCIA ---
      { n: 51, enu: "O poder de pol√≠cia da guarda deve sempre ser exercido sem viol√™ncia desnecess√°ria.", vf: true, correta: "V" },
      { n: 52, enu: "A autoexecutoriedade √© uma das caracter√≠sticas do poder de pol√≠cia.", vf: true, correta: "V" },
      { n: 53, enu: "A coercibilidade significa que a ordem pode ser imposta mesmo contra a vontade do administrado.", vf: true, correta: "V" },
      { n: 54, enu: "Discricionariedade, autoexecutoriedade e coercibilidade s√£o caracter√≠sticas do poder de pol√≠cia.", vf: true, correta: "V" },
      { n: 55, enu: "O plano de seguran√ßa da unidade deve estar afixado em local vis√≠vel no Corpo da Guarda.", vf: true, correta: "V" },

      // --- RESPONSABILIDADES ---
      { n: 56, enu: "√â atribui√ß√£o do FunOf acompanhar de perto a execu√ß√£o do servi√ßo da guarda.", vf: true, correta: "V" },
      { n: 57, enu: "O Adjunto do FunOf apoia na execu√ß√£o das escalas e rotinas da guarda.", vf: true, correta: "V" },
      { n: 58, enu: "O sentinela n√£o precisa manter vigil√¢ncia constante durante seu posto.", vf: true, correta: "F" },
      { n: 59, enu: "Cabe ao Comandante da Guarda supervisionar diretamente os sentinelas.", vf: true, correta: "V" },
      { n: 60, enu: "O Corpo da Guarda √© local de livre acesso a qualquer militar da unidade.", vf: true, correta: "F" },

      // --- ESTADOS DE PRONTID√ÉO ---
      { n: 61, enu: "Estado branco representa aten√ß√£o m√°xima.", vf: true, correta: "F" },
      { n: 62, enu: "Estado amarelo √© considerado o estado ideal de vigil√¢ncia cotidiana.", vf: true, correta: "V" },
      { n: 63, enu: "Estado preto deve ser evitado com treinamento e gest√£o de estresse.", vf: true, correta: "V" },
      { n: 64, enu: "O estado vermelho exige resposta imediata e proporcional.", vf: true, correta: "V" },
      { n: 65, enu: "O estado laranja indica relaxamento completo.", vf: true, correta: "F" },

      // --- SUPREMACIA DE FOR√áA ---
      { n: 66, enu: "Supremacia de for√ßa depende apenas do porte de armamento.", vf: true, correta: "F" },
      { n: 67, enu: "Surpresa, dist√¢ncia e autocontrole ajudam a compensar eventual desvantagem num√©rica.", vf: true, correta: "V" },
      { n: 68, enu: "Urbanidade e clareza no motivo da a√ß√£o refor√ßam a autoridade da guarda.", vf: true, correta: "V" },
      { n: 69, enu: "Supremacia de for√ßa pode ser tanto t√°tica quanto din√¢mica.", vf: true, correta: "V" },
      { n: 70, enu: "Trucul√™ncia √© considerada forma adequada de manter supremacia de for√ßa.", vf: true, correta: "F" },

      // --- USO DA FOR√áA ---
      { n: 71, enu: "Resist√™ncia passiva √© quando o abordado se nega a cooperar sem reagir fisicamente.", vf: true, correta: "V" },
      { n: 72, enu: "Resist√™ncia ativa letal justifica o emprego de for√ßa potencialmente letal.", vf: true, correta: "V" },
      { n: 73, enu: "Uso progressivo da for√ßa significa aplicar sempre o n√≠vel mais alto dispon√≠vel.", vf: true, correta: "F" },
      { n: 74, enu: "A presen√ßa do militar j√° √© forma de uso de for√ßa prim√°rio.", vf: true, correta: "V" },
      { n: 75, enu: "Uso diferenciado da for√ßa deve sempre buscar legalidade, necessidade e proporcionalidade.", vf: true, correta: "V" },

      // --- ALGEMAS ---
      { n: 76, enu: "As algemas por si s√≥ garantem que o preso n√£o fuja.", vf: true, correta: "F" },
      { n: 77, enu: "√â recomend√°vel algemar o indiv√≠duo com as m√£os para tr√°s e palmas para fora.", vf: true, correta: "V" },
      { n: 78, enu: "Algemas devem sempre ser acompanhadas de vigil√¢ncia do algemado.", vf: true, correta: "V" },
      { n: 79, enu: "O art. 242 do CPPM prev√™ exce√ß√µes ao uso de algemas.", vf: true, correta: "V" },
      { n: 80, enu: "A S√∫mula Vinculante 11 obriga justificar por escrito o uso de algemas em situa√ß√µes excepcionais.", vf: true, correta: "V" },

      // --- DESLOCAMENTO / ARMAS ---
      { n: 81, enu: "No deslocamento r√°pido, arma deve permanecer no coldre.", vf: true, correta: "F" },
      { n: 82, enu: "Na posi√ß√£o 2 (guarda-baixa), a arma fica a 45¬∞ com dedo fora do gatilho.", vf: true, correta: "V" },
      { n: 83, enu: "Na posi√ß√£o 4 (pronta resposta), a arma fica apontada para o alvo com risco letal.", vf: true, correta: "V" },
      { n: 84, enu: "A posi√ß√£o 1 significa arma j√° empunhada e apontada.", vf: true, correta: "F" },
      { n: 85, enu: "Durante deslocamento t√°tico, cada militar deve saber o que, quando e onde agir.", vf: true, correta: "V" },

      // --- VARREDURA ---
      { n: 86, enu: "Fatiamento, olhada r√°pida e reflex√£o de imagem s√£o t√©cnicas de varredura.", vf: true, correta: "V" },
      { n: 87, enu: "Olhada r√°pida deve sempre expor o corpo inteiro do militar.", vf: true, correta: "F" },
      { n: 88, enu: "Reflex√£o de imagem √© recurso para observar sem se expor totalmente.", vf: true, correta: "V" },
      { n: 89, enu: "A varredura deve considerar pontos de foco e pontos quentes.", vf: true, correta: "V" },
      { n: 90, enu: "Varredura √© desnecess√°ria em ambientes controlados.", vf: true, correta: "F" },

      // --- ABORDAGEM DE PESSOAS ---
      { n: 91, enu: "Na abordagem, deve-se evitar posicionamento no 'V' dos bra√ßos do suspeito.", vf: true, correta: "V" },
      { n: 92, enu: "No TAT, os PMs devem se manter alinhados frontalmente com o suspeito.", vf: true, correta: "F" },
      { n: 93, enu: "A busca pessoal minuciosa pode ser feita em quatro posi√ß√µes: em p√©, em p√© com apoio, ajoelhado e deitado.", vf: true, correta: "V" },
      { n: 94, enu: "Busca pessoal ligeira √© usada em eventos e portarias.", vf: true, correta: "V" },
      { n: 95, enu: "Busca completa pode envolver inspe√ß√£o de cavidades corporais, com testemunha do mesmo sexo.", vf: true, correta: "V" },

      // --- VE√çCULOS ---
      { n: 96, enu: "Na abordagem de ve√≠culos, h√° √°reas de conten√ß√£o, seguran√ßa, risco, aproxima√ß√£o, alcance, busca e cust√≥dia.", vf: true, correta: "V" },
      { n: 97, enu: "O posicionamento paralelo √© uma das formas corretas de abordagem a ve√≠culos.", vf: true, correta: "V" },
      { n: 98, enu: "Na abordagem de motocicletas, os capacetes devem ser mantidos no suspeito para limitar sua vis√£o.", vf: true, correta: "V" },
      { n: 99, enu: "O desembarque de motociclistas deve ser feito pela retaguarda e com m√£os na cabe√ßa.", vf: true, correta: "V" },
      { n: 100, enu: "Abordagem de ve√≠culos n√£o exige varredura visual pr√©via.", vf: true, correta: "F" }

    ];

    const lista = document.getElementById('lista');

    function render() {
      lista.innerHTML = '';
      for (const q of questoes) {
        const div = document.createElement('div');
        div.className = 'q';
        div.id = `q${q.n}`;
        div.innerHTML = `
                <div class="q-head">
                  <div class="q-title"><span class="chip">${q.n}</span> ${q.enu}</div>
                  <button class="btn" data-action="verificar">Verificar</button>

                </div>
                <div class="q-body" role="group" aria-label="Quest√£o ${q.n}"></div>
                <div class="status"></div>
              `;

        const body = div.querySelector('.q-body');
        if (q.vf) {
          ['V', 'F'].forEach(val => {
            const label = document.createElement('label');
            label.className = 'alt';
            label.innerHTML = `<input type="radio" name="q${q.n}" value="${val}"> ${val}`;
            body.appendChild(label);
          });
        } else {
          const letras = ['a', 'b', 'c', 'd'];
          q.alts.forEach((txt, idx) => {
            const letra = letras[idx];
            const label = document.createElement('label');
            label.className = 'alt';
            label.innerHTML = `<input type="radio" name="q${q.n}" value="${letra}"> (${letra}) ${txt}`;
            body.appendChild(label);
          });
        }
        lista.appendChild(div);
      }

      lista.addEventListener('change', e => {
        const lab = e.target?.closest?.('.alt');
        if (lab) {
          const group = lab.parentElement;
          group.querySelectorAll('.alt').forEach(x => x.classList.remove('sel'));
          lab.classList.add('sel');
        }
      });

      lista.addEventListener('click', e => {
        const btn = e.target.closest('button[data-action="verificar"]');
        if (!btn) return;
        const card = btn.closest('.q');
        const n = Number(card.id.replace('q', ''));
        verificar(n);
        atualizarPlacar();
      });
    }

    function verificar(n) {
      const q = questoes.find(x => x.n === n);
      const card = document.getElementById(`q${n}`);
      const status = card.querySelector('.status');
      const marcada = card.querySelector('input:checked');
      card.classList.remove('ok-bg', 'bad-bg');
      status.className = 'status';
      if (!marcada) { status.textContent = 'N√£o respondida.'; return false; }
      const val = marcada.value.toLowerCase();
      const ok = (q.vf ? val.toUpperCase() : val) === q.correta;
      if (ok) {
        card.classList.add('ok-bg');
        status.classList.add('ok');
        status.textContent = '‚úî Correto';
      } else {
        card.classList.add('bad-bg');
        status.classList.add('bad');
        if (q.vf) {
          status.textContent = `‚úñ Incorreto. Correto: ${q.correta}`;
        } else {
          const letras = ['a', 'b', 'c', 'd'];
          const idx = letras.indexOf(q.correta);
          const textoCorreto = q.alts[idx];
          status.textContent = `‚úñ Incorreto. Correto: (${q.correta}) ${textoCorreto}`;
        }
      }
      return ok;
    }

    function verificarTudo() {
      let withKey = 0, correct = 0;
      for (const q of questoes) {
        withKey++;
        if (verificar(q.n)) correct++;
      }
      atualizarPlacar(correct, withKey);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function atualizarPlacar(forceCorrect, forceTotal) {
      let total = forceTotal ?? questoes.length;
      let correct = forceCorrect ?? Array.from(document.querySelectorAll('.status.ok')).length;
      document.getElementById('score').textContent = `Acertos: ${correct}/${total}`;
      const ap = total ? Math.round((correct / total) * 100) : 0;
      document.getElementById('aproveitamento').textContent = `Aproveitamento: ${ap}%`;
    }

    function resetar() {
      document.querySelectorAll('input[type="radio"]').forEach(i => i.checked = false);
      document.querySelectorAll('.alt').forEach(l => l.classList.remove('sel'));
      document.querySelectorAll('.q').forEach(c => c.classList.remove('ok-bg', 'bad-bg'));
      document.querySelectorAll('.status').forEach(s => { s.className = 'status'; s.textContent = ''; });
      atualizarPlacar(0, questoes.length);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function exportCSV() {
      const linhas = [["#", "Enunciado", "Resposta", "Gabarito", "Resultado"]];
      for (const q of questoes) {
        const card = document.getElementById(`q${q.n}`);
        const marcada = card.querySelector('input:checked');
        let resp = marcada ? marcada.value.toUpperCase() : '';
        let gab = q.vf ? q.correta : q.correta.toUpperCase();
        let resultado = card.querySelector('.status').classList.contains('ok') ? 'Correto' : (marcada ? 'Incorreto' : 'N√£o respondida');
        linhas.push([q.n, q.enu.replaceAll('\n', ' ').trim(), resp, gab, resultado]);
      }
      const csv = linhas.map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'resultado_simulado_dh.csv'; a.click();
      setTimeout(() => URL.revokeObjectURL(url), 1500);
    }

    // Render e binds iniciais
    render();
    atualizarPlacar(0, questoes.length);

    document.getElementById('btnCheckAll').addEventListener('click', verificarTudo);
    document.getElementById('btnReset').addEventListener('click', resetar);
    document.getElementById('btnExport').addEventListener('click', exportCSV);
  </script>
</body>

</html>
